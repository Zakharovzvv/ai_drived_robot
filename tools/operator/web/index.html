<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RBM Operator Console</title>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <header>
      <div class="header-content">
        <div class="header-title">
          <h1>RBM Operator Console</h1>
          <p>Monitor robot state and dispatch safe commands.</p>
        </div>
        <div class="connection-status">
          <span class="status-indicator" id="ws-status" aria-live="polite">
            <span class="status-dot" role="img" aria-label="Connection status"></span>
            <span class="status-text">Connecting...</span>
          </span>
        </div>
      </div>
    </header>

    <!-- Command Bar (sticky) -->
    <div class="command-bar">
      <div class="command-bar-content">
        <div class="primary-actions">
          <form id="start-form" class="inline-form">
            <input 
              id="start-task" 
              name="task" 
              type="text" 
              value="default" 
              placeholder="Task ID"
              aria-label="Task identifier"
            />
            <button type="submit" class="btn-primary btn-action" title="Start task">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3"/>
              </svg>
              Start Task
            </button>
          </form>

          <button id="brake-button" type="button" class="btn-danger btn-action" aria-keyshortcuts="Control+B" title="Emergency stop (Ctrl+B)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <rect x="9" y="9" width="6" height="6"/>
            </svg>
            BRAKE
          </button>
        </div>

        <form id="command-form" class="inline-form command-input-group">
          <input 
            id="raw-command" 
            name="command" 
            type="text" 
            placeholder="Enter CLI command (e.g., STATUS)" 
            aria-label="Direct CLI command"
          />
          <button type="submit" class="btn-secondary" title="Send command">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
            Send
          </button>
        </form>
      </div>
    </div>

    <!-- Main Layout: Telemetry (wide) + Status (sidebar) -->
    <main class="main-layout">
      <section class="telemetry-section">
        <div class="section-header">
          <h2>Live Telemetry</h2>
          <div class="legend" id="telemetry-legend" role="list"></div>
        </div>
        <div class="chart-container">
          <canvas id="telemetry-chart" role="img" aria-label="Real-time telemetry chart"></canvas>
        </div>
      </section>

      <aside class="status-sidebar">
        <div class="section-header">
          <h2>Status</h2>
          <button id="refresh-status" type="button" class="btn-icon" aria-label="Refresh status" title="Refresh status">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>
          </button>
        </div>
        <div class="status-grid" id="status-grid" role="region" aria-live="polite">
          <div class="skeleton-loader"></div>
        </div>
      </aside>
    </main>

    <!-- Command Output (expandable footer) -->
    <div class="output-bar">
      <button class="output-toggle" id="output-toggle" aria-expanded="false" aria-controls="command-output">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="18 15 12 9 6 15"/>
        </svg>
        <span>Command Output</span>
      </button>
      <div class="output-content" id="output-content" hidden>
        <pre id="command-output" class="output" role="log" aria-live="polite" aria-atomic="true"></pre>
      </div>
    </div>

    <footer>
      <small>ESP32 link via local FastAPI gateway. Ensure the server is running on port 8000.</small>
    </footer>

    <!-- Toast notifications -->
    <div id="toast-container" aria-live="assertive" aria-atomic="true"></div>

    <!-- Confirmation modal -->
    <div id="modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
      <div class="modal-content">
        <h2 id="modal-title"></h2>
        <p id="modal-message"></p>
        <div class="modal-actions">
          <button id="modal-cancel" class="btn-secondary">Cancel</button>
          <button id="modal-confirm" class="btn-danger">Confirm</button>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
